<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="QzC4gqNx1vAo_VxH0sQdkAvL5X7d_WsC8VNpcpEBfIE">
  <meta name="msvalidate.01" content="F9B7AE033F8B45BAE6C0FCF06DD118A5">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":true,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"disqusjs","storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="高性能RPC框架，主要用于服务治理。包括功能：  负载均衡（默认加权随机） 集群容错（默认failover） 服务降级 监控（Monitor） 提供者和消费者定时每分钟发送一次统计数据到监控中心   服务注册与发现特点：连通性、健壮性、伸缩性">
<meta property="og:type" content="blog">
<meta property="og:title" content="Dubbo">
<meta property="og:url" content="http://yoursite.com/2018/08/20/dubbo/index.html">
<meta property="og:site_name" content="快递小哥的博客">
<meta property="og:description" content="高性能RPC框架，主要用于服务治理。包括功能：  负载均衡（默认加权随机） 集群容错（默认failover） 服务降级 监控（Monitor） 提供者和消费者定时每分钟发送一次统计数据到监控中心   服务注册与发现特点：连通性、健壮性、伸缩性">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/dubbo-provider.jpg">
<meta property="og:image" content="http://yoursite.com/images/dubbo-consumer.jpg">
<meta property="article:published_time" content="2018-08-20T15:25:52.000Z">
<meta property="article:modified_time" content="2024-07-31T13:26:44.719Z">
<meta property="article:author" content="快递小哥">
<meta property="article:tag" content="Dubbo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/dubbo-provider.jpg">


<link rel="canonical" href="http://yoursite.com/2018/08/20/dubbo/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yoursite.com/2018/08/20/dubbo/","path":"2018/08/20/dubbo/","title":"Dubbo"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Dubbo | 快递小哥的博客</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?a306ba7f95495f3af39fa0d1cfcc50ed"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="快递小哥的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">快递小哥的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6"><span class="nav-number">1.</span> <span class="nav-text">启动检查机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">2.</span> <span class="nav-text">负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99"><span class="nav-number">3.</span> <span class="nav-text">集群容错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="nav-number">4.</span> <span class="nav-text">服务降级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Registry%EF%BC%88%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">Registry（注册中心）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Container%EF%BC%88%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">Container（容器）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Protocol%EF%BC%88%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="nav-number">7.</span> <span class="nav-text">Protocol（协议）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81"><span class="nav-number">8.</span> <span class="nav-text">多版本支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BA%E7%BB%91%E5%AE%9A"><span class="nav-number">9.</span> <span class="nav-text">主机绑定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">10.</span> <span class="nav-text">配置优先级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-SPI%E5%92%8CJava-SPI%E5%8C%BA%E5%88%AB"><span class="nav-number">11.</span> <span class="nav-text">Dubbo SPI和Java SPI区别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Java-SPI"><span class="nav-number">11.1.</span> <span class="nav-text">Java SPI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo-SPI"><span class="nav-number">11.2.</span> <span class="nav-text">Dubbo SPI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="nav-number">12.</span> <span class="nav-text">源码解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo%E4%B8%ADSpring-XML%E6%89%A9%E5%B1%95"><span class="nav-number">12.1.</span> <span class="nav-text">Dubbo中Spring XML扩展</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ExtensionLoader"><span class="nav-number">12.2.</span> <span class="nav-text">ExtensionLoader</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RpcContext"><span class="nav-number">12.3.</span> <span class="nav-text">RpcContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C"><span class="nav-number">12.4.</span> <span class="nav-text">服务注册</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9"><span class="nav-number">12.5.</span> <span class="nav-text">服务消费</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exporter"><span class="nav-number">12.6.</span> <span class="nav-text">Exporter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Invoker"><span class="nav-number">12.7.</span> <span class="nav-text">Invoker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Directory"><span class="nav-number">12.8.</span> <span class="nav-text">Directory</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="快递小哥"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">快递小哥</p>
  <div class="site-description" itemprop="description">读万卷书，更要行万里路！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xlZTkyMTM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lee9213"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmxlZTkyMTNAMTYzLmNvbQ==" title="E-Mail → mailto:lee9213@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9leGFtcGxlLmNvbQ==" title="https:&#x2F;&#x2F;example.com">mysql1</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9leGFtcGxlLmNvbQ==" title="https:&#x2F;&#x2F;example.com">mysql2</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9leGFtcGxlLmNvbQ==" title="https:&#x2F;&#x2F;example.com">mysql3</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9leGFtcGxlLmNvbQ==" title="https:&#x2F;&#x2F;example.com">mysql4</span>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/dubbo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="快递小哥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="快递小哥的博客">
      <meta itemprop="description" content="读万卷书，更要行万里路！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Dubbo | 快递小哥的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Dubbo
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-20 23:25:52" itemprop="dateCreated datePublished" datetime="2018-08-20T23:25:52+08:00">2018-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-31 21:26:44" itemprop="dateModified" datetime="2024-07-31T21:26:44+08:00">2024-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>高性能RPC框架，主要用于服务治理。包括功能：</p>
<ul>
<li>负载均衡（默认加权随机）</li>
<li>集群容错（默认failover）</li>
<li>服务降级</li>
<li>监控（Monitor）<ul>
<li>提供者和消费者定时每分钟发送一次统计数据到监控中心</li>
</ul>
</li>
<li>服务注册与发现<br>特点：连通性、健壮性、伸缩性<span id="more"></span></li>
</ul>
<h3 id="启动检查机制"><a href="#启动检查机制" class="headerlink" title="启动检查机制"></a>启动检查机制</h3><ul>
<li>关闭某个服务的启动时检查<br>xml：<code>&lt;dubbo:reference interface=&quot;com.test.service.IHelloService&quot; check=&quot;false&quot;&gt;</code><br>properties：<code>dubbo.reference.com.test.service.IHelloService.check=false </code><br>-D参数：<code>java -Ddubbo.reference.com.test.service.IHelloService.check=false </code></li>
<li>关闭所有服务的启动时检查<br>xml：<code>&lt;dubbo:consumer check=&quot;false&quot;/&gt;</code><br>properties：<code>dubbo.consumer.check=false </code><br>-D参数：<code>java -Ddubbo.consumer.check=false </code></li>
<li>关闭注册中心启动时检查<br>xml：<code>&lt;dubbo:registry check=&quot;false&quot;/&gt;</code><br>properties：<code>dubbo.registry.check=false </code><br>-D参数：<code>java -Ddubbo.registry.check=false </code></li>
</ul>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><ul>
<li>RandomLoadBalance（加权随机）默认<ul>
<li>计算出总权重</li>
<li>根据总权重获取权重随机数，遍历IP，进行权重递减，当权重小于0时，取下标</li>
</ul>
</li>
<li>LeastActiveLoadBalance（加权最小活跃）<ul>
<li>取出最小活跃数相同的机器，如果权重相同，则随机选取</li>
<li>取出最小活跃数相同的机器，如果权重不同，按照加权随机算法选取</li>
</ul>
</li>
<li>RoundRobinLoadBalance（加权轮询）</li>
<li>ConsistentHashLoadBalance（一致性hash）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置key：random、roundrobin、leastactive、consistenthash --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 服务端服务级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;random&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 客户端服务级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;roundrobin&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 服务端方法级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;leastactive&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 客户端方法级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;consistenthash&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="集群容错"><a href="#集群容错" class="headerlink" title="集群容错"></a>集群容错</h3><ul>
<li>容错机制：某种系统控制在一定范围内的一种允许或包容犯错情况的发生</li>
<li>容错策略<ul>
<li>failsafe：失败安全，出现异常时，直接忽略。通常用于写入审计日志等操作。</li>
<li>failover：<strong>默认策略</strong>，失败自动切换，当出现失败，重试其他服务器。通常用于读操作，但重试会带来更长延迟，可通过<code>retries=&quot;2&quot;</code>来设置重试次数，默认2次（不含第一次）。</li>
<li>failfast：快速失败，只发起一次调用，失败立即报错。通常用于非幂等性的写操作，比如新增记录。</li>
<li>failback：失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。</li>
<li>forking：并行调用多个服务器，只要一个成功即返回。通常用于实时性较高的读操作，但需要浪费更多服务资源。可通过<code>forks=&quot;2&quot;</code>来设置最大并行数。</li>
<li>broadcast：广播所有提供者，逐个调用，任意一台报错即报错。通常用于通知所有提供者更新缓存或日志等本地资源信息。</li>
</ul>
</li>
<li>配置方式<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置cluster属性，指定容错策略，默认failover --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;com.test.service.IHelloService&quot;</span> 				<span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h3><ul>
<li>人工降级和自动降级</li>
<li>功能区分：读服务降级和写服务降级</li>
<li>故障降级（设置默认值&#x2F;采用兜底数据）</li>
<li>dubbo降级方式：Mock方式</li>
<li>集群容错策略为failsafe&#x2F;failback时，<strong>不能使用降级</strong><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置一个mock属性，对应的值是属性interface对应接口的实现类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;com.test.service.IHelloService&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> 	</span></span><br><span class="line"><span class="tag">    <span class="attr">mock</span>=<span class="string">&quot;com.test.service.mock.HelloServiceMock&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Registry（注册中心）"><a href="#Registry（注册中心）" class="headerlink" title="Registry（注册中心）"></a>Registry（注册中心）</h3><p>Dubbo支持同一服务向多注册中心同时注册或不同服务分别注册到不同的注册中心。</p>
<ul>
<li><p>DubboRegistry（Netty实现）</p>
</li>
<li><p>ZookeeperRegistry（zookeeper实现）</p>
</li>
<li><p>RedisRegistry（Redis实现）</p>
</li>
<li><p>MulticastRegistry（广播，去中心化，不需要安装注册中心）<br>组播受网络结构限制，只适合小规模应用或开发阶段使用。组播地址段: 224.0.0.0 - 239.255.255.255</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多注册中心配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">&quot;zk1Registry&quot;</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.0.1:2181&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">&quot;zk2Registry&quot;</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.0.2:2181&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 向多个注册中心注册 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;zk1Registry,zk2Registry&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 不同服务注册到不同注册中心 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 向zk1Registry注册中心注册 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;zk1Registry&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 向zk2Registry注册中心注册 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;zk2Registry&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Container（容器）"><a href="#Container（容器）" class="headerlink" title="Container（容器）"></a>Container（容器）</h3><ul>
<li>SpringContainer（默认）</li>
<li>JettyContainer（启动一个内嵌Jetty）</li>
<li>Log4jContainer（自动配置log4j的配置）</li>
<li>LogbackContainer</li>
</ul>
<h3 id="Protocol（协议）"><a href="#Protocol（协议）" class="headerlink" title="Protocol（协议）"></a>Protocol（协议）</h3><p>Dubbo允许配置多协议，在不同服务上支持不同协议或者同一服务上同时支持多种协议</p>
<ul>
<li><p>HttpProtocol（基于HTTP表单的远程调用协议，采用Spring的HttpInvoker实现）</p>
<ul>
<li>连接个数：多连接</li>
<li>连接方式：短连接</li>
<li>传输协议：HTTP</li>
<li>传输方式：同步传输</li>
<li>序列化：表单序列化</li>
<li>适用范围：传入传出参数数据包大小混合，提供者比消费者个数多，可用浏览器查看，可用表单或URL传入参数，暂不支持传文件。</li>
<li>适用场景：需同时给应用程序和浏览器 JS 使用的服务。</li>
</ul>
</li>
<li><p>RmiProtocol（采用JDK标准的<code>java.rmi.*</code>实现，采用阻塞式短连接和JDK标准序列化方式。）</p>
<ul>
<li>连接个数：多连接</li>
<li>连接方式：短连接</li>
<li>传输协议：TCP</li>
<li>传输方式：同步传输</li>
<li>序列化：Java 标准二进制序列化</li>
<li>适用范围：传入传出参数数据包大小混合，消费者与提供者个数差不多，可传文件。</li>
<li>适用场景：常规远程服务方法调用，与原生RMI服务互操作</li>
<li>dubbo 配置中的超时时间对RMI无效，需使用java启动参数设置：<code>-Dsun.rmi.transport.tcp.responseTimeout=3000</code></li>
</ul>
</li>
<li><p>HessianProtocol（底层采用Http通讯，采用Servlet暴露服务，Dubbo 缺省内嵌 Jetty 作为服务器实现）</p>
<ul>
<li>连接个数：多连接</li>
<li>连接方式：短连接</li>
<li>传输协议：HTTP</li>
<li>传输方式：同步传输</li>
<li>序列化：Hessian二进制序列化</li>
<li>适用范围：传入传出参数数据包较大，提供者比消费者个数多，提供者压力较大，可传文件。</li>
<li>适用场景：页面传输，文件传输，或与原生hessian服务互操作</li>
</ul>
</li>
<li><p>ThriftProtocol（Netty实现）</p>
</li>
<li><p>DubboProtocol（Netty实现，采用NIO复用单一长连接）</p>
<ul>
<li>连接个数：单连接</li>
<li>连接方式：长连接</li>
<li>传输协议：TCP</li>
<li>传输方式：NIO 异步传输</li>
<li>序列化：Hessian 二进制序列化</li>
<li>适用范围：传入传出参数数据包较小（建议小于100K），消费者比提供者个数多，单一消费者无法压满提供者，尽量不要用 dubbo 协议传输大文件或超大字符串。</li>
<li>适用场景：常规远程服务方法调用</li>
</ul>
</li>
<li><p>InjvmProtocol</p>
</li>
<li><p>WebServiceProtocol（基于WebService的远程调用协议，基于Apache CXF的<code>frontend-simple</code> 和 <code>transports-http</code>实现)</p>
<ul>
<li>连接个数：多连接</li>
<li>连接方式：短连接</li>
<li>传输协议：HTTP</li>
<li>传输方式：同步传输</li>
<li>序列化：SOAP 文本序列化</li>
<li>适用场景：系统集成，跨语言调用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多协议配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1099&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用dubbo协议暴露服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;...&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;dubbo&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用rmi协议暴露服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;...&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;rmi&quot;</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用不同协议暴露同一服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;...&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;dubbo,rmi&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="多版本支持"><a href="#多版本支持" class="headerlink" title="多版本支持"></a>多版本支持</h3><p>在dubbo配置文件中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.test.service.IHelloService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.test.service.IHelloService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.service.impl.HelloServiceImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在zookeeper会生成不同url的两个节点</p>
<h3 id="主机绑定"><a href="#主机绑定" class="headerlink" title="主机绑定"></a>主机绑定</h3><p>发布服务时会生成一个dubbo:&#x2F;&#x2F;ip:prot的协议地址</p>
<ol>
<li><p>从<code>&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; host=&quot;192.168.0.18&quot;/&gt;</code>配置中获取<code>host</code>的属性值</p>
</li>
<li><p>如果步骤1中获取到的地址无效，则从<code>InetAddress.getLocalHost().getHostAddress()</code>中获取</p>
</li>
<li><p>如果步骤2中获取到的地址无效，则通过连接zookeeper，然后获取连接zookeeper的客户端的本地地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接zookeeper</span></span><br><span class="line"><span class="type">SocketAddress</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(registryURL.getHost(),registryURL.getPort());</span><br><span class="line">socket.connect(addr, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 获取连接zookeeper的客户端的本地地址</span></span><br><span class="line">host = socket.getLocalAddress().getHostAddress();</span><br></pre></td></tr></table></figure></li>
<li><p>如果步骤3中未获取到地址，则从<code>NetUtils.getLocalHost()</code>获取地址。</p>
</li>
</ol>
<h3 id="配置优先级"><a href="#配置优先级" class="headerlink" title="配置优先级"></a>配置优先级</h3><ul>
<li>XML配置<br>以timeout为例，显示了配置的查找顺序，其他retries、loadbalance等类似。<ul>
<li>方法级优先，接口级次之，全局配置再次之。</li>
<li>如果级别一样，则消费者优先，提供者次之。<br>其中，服务提供方配置，通过URL经由注册中心传递给消费方。建议由服务提供方设置超时。</li>
</ul>
</li>
<li>属性配置参数优先级<ul>
<li>JVM启动参数优先，比如 <code>-Ddubbo.protocol.port=20880</code>，</li>
<li>XML次之，比如 <code>&lt;dubbo:protoocol port=&quot;20880&quot;/&gt;</code></li>
<li>Properties最后，相当于缺省值。比如 <code>dubbo.protocol.port=20880</code></li>
</ul>
</li>
</ul>
<h3 id="Dubbo-SPI和Java-SPI区别"><a href="#Dubbo-SPI和Java-SPI区别" class="headerlink" title="Dubbo SPI和Java SPI区别"></a>Dubbo SPI和Java SPI区别</h3><h4 id="Java-SPI"><a href="#Java-SPI" class="headerlink" title="Java SPI"></a>Java SPI</h4><p>service provider interface，JDK内置的一种服务提供发现机制，动态替换发现的机制。</p>
<ul>
<li>规范<ol>
<li>需在META-INF&#x2F;services下建立一个文件，文件的规范：<ol>
<li>文件名必须是扩展的接口的全路径名称</li>
<li>文件内部描述的是该扩展接口的所有实现类</li>
<li>文件的编码格式必须是UTF-8</li>
</ol>
</li>
<li>通过java.util.ServiceLoader来加载</li>
</ol>
</li>
<li>缺点<ol>
<li>JDK标准的SPI会一次性加载实例化扩展点的所有实现，如果有的扩展点实现初始化很耗时或者有些实现类并没有用到，这样就会很耗费资源</li>
<li>如果扩展点加载失败，会导致调用方报错，而且这个错误很难定位到某个原因</li>
</ol>
</li>
</ul>
<h4 id="Dubbo-SPI"><a href="#Dubbo-SPI" class="headerlink" title="Dubbo SPI"></a>Dubbo SPI</h4><ul>
<li>规范<ol>
<li>需建立要给配置文件，目录为：META-INF&#x2F;dubbo、META-INF&#x2F;dubbo&#x2F;internal、META-INF&#x2F;services</li>
<li>文件名必须是扩展的接口的全路径名称，内容是key-value<ul>
<li>key：别名</li>
<li>value：扩展接口的实现类</li>
</ul>
</li>
</ol>
</li>
<li>知识点<ul>
<li>@Adaptive：自适应扩展点<ul>
<li>类级别：直接加载当前自定义的自适应扩展点</li>
<li>方法级别：动态生成一个自适应扩展点，比如：Protocol$Adaptvie、Container$Adaptive</li>
<li>自动包装扩展点的 Wrapper 类。<code>ExtensionLoader</code> 在加载扩展点时，如果加载到的扩展点有拷贝构造函数，则判定为扩展点 Wrapper 类。Wrapper 类同样实现了扩展点接口，但是 Wrapper 不是扩展点的真正实现。扩展点的 Wrapper 类可以有多个。（AOP实现）</li>
<li>加载扩展点时，自动注入依赖的扩展点。加载扩展点时，扩展点实现类的成员如果为其它扩展点类型，<code>ExtensionLoader</code> 在会自动注入依赖的扩展点。<code>ExtensionLoader</code> 通过扫描扩展点实现类的所有 setter 方法来判定其成员。即 <code>ExtensionLoader</code> 会执行扩展点的拼装操作。（IOC实现）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取默认扩展点，此处代表获取Container的SPI注解的value所指定的扩展点SpringContainer</span></span><br><span class="line">ExtensionLoader.getExtensionLoader(Container.class).getDefaultExtension();</span><br><span class="line"><span class="comment">// 获取自适应扩展点，此处代表获取Container的自适应扩展点Container$Adaptive</span></span><br><span class="line">ExtensionLoader.getExtensionLoader(Container.class).getAdaptiveExtension()</span><br></pre></td></tr></table></figure>
@Activate：自动激活</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h3><h4 id="Dubbo中Spring-XML扩展"><a href="#Dubbo中Spring-XML扩展" class="headerlink" title="Dubbo中Spring XML扩展"></a>Dubbo中Spring XML扩展</h4><p>Dubbo是基于spring配置来实现服务的发布的，</p>
<ol>
<li>新建xsd文件，配置标签内容，在META-INF&#x2F;spring.schemas文件中声明xsd路径</li>
<li>实现BeanDefinitionParser接口</li>
<li>继承NamespaceHandlerSupport ，重写init方法，调用registerBeanDefinitionParser注册标签解析器</li>
<li>在META-INF&#x2F;spring.handlers文件中声明步骤2中实现类</li>
</ol>
<h4 id="ExtensionLoader"><a href="#ExtensionLoader" class="headerlink" title="ExtensionLoader"></a>ExtensionLoader</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个ExtensionLoader</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ExtensionLoader&lt;T&gt; <span class="title function_">getExtensionLoader</span><span class="params">(Class&lt;T&gt; type)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个自适应扩展点</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">getAdaptiveExtension</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="comment">// 判断如果不存在自适应扩展点，则调用</span></span><br><span class="line">    createAdaptiveExtension()；</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个自适应扩展点</span></span><br><span class="line"><span class="keyword">private</span> T <span class="title function_">createAdaptiveExtension</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> injectExtension((T) getAdaptiveExtensionClass().newInstance());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为自适应扩展点进行依赖注入，为适配器类的setter方法注入其他扩展点（IOC实现）</span></span><br><span class="line"><span class="keyword">private</span> T <span class="title function_">injectExtension</span><span class="params">(T instance)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个自适应适配器类</span></span><br><span class="line"><span class="keyword">private</span> Class&lt;?&gt; getAdaptiveExtensionClass() &#123;</span><br><span class="line">    <span class="comment">// 加载所有路径下的扩展点的类</span></span><br><span class="line">    <span class="comment">// 路径包括：META-INF/dubbo、META-INF/dubbo/internal、META-INF/services</span></span><br><span class="line">    getExtensionClasses();</span><br><span class="line">    <span class="comment">// 如果不存在，动态生成适配器代码，以及动态编译，返回一个动态创建的自适应适配器的类</span></span><br><span class="line">    <span class="comment">// Compiler可以动态扩展，自带实现有AdaptiveCompiler、JdkCompiler、JavassistCompiler</span></span><br><span class="line">    <span class="comment">// 默认使用AdaptiveCompiler，AdaptiveCompiler中默认的是JavassistCompiler</span></span><br><span class="line">    <span class="comment">// 最终使用JavassistCompiler编译</span></span><br><span class="line">    <span class="comment">// 返回一个自适应适配器类,类名类似Protocol$Adaptive、Cluster$Adaptive</span></span><br><span class="line">    <span class="comment">// Protocol$Adaptive的作用</span></span><br><span class="line">    <span class="comment">// 		1. 从URL或扩展接口获取扩展接口实现类的名称</span></span><br><span class="line">    <span class="comment">// 		2. 根据名称，获取最终需要的扩展点实现类</span></span><br><span class="line">    <span class="comment">// 适配器类的目的是在运行期获取扩展的真正实现来调用，解耦接口和实现</span></span><br><span class="line">    createAdaptiveExtensionClass();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回一个扩展点的实现类</span></span><br><span class="line"><span class="comment">// 如果一个扩展点的实现类的构造函数包含了这个扩展点的接口，则这个实现类是对这个扩展点的包装，比如ProtocolFilterWrapper和ProtocolListenerWrapper对Protocol进行了包装</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">getExtension</span><span class="params">(String name)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="RpcContext"><a href="#RpcContext" class="headerlink" title="RpcContext"></a>RpcContext</h4><ol>
<li>获取上下文信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：每发起RPC调用，上下文状态会变化</span></span><br><span class="line"><span class="comment">// 获取最后一次调用的提供方IP地址</span></span><br><span class="line"><span class="type">String</span> <span class="variable">serverIP</span> <span class="operator">=</span> RpcContext.getContext().getRemoteHost();</span><br><span class="line"><span class="comment">// 获取当前服务配置信息，所有配置信息都将转换为URL的参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">application</span> <span class="operator">=</span> RpcContext.getContext().getUrl().getParameter(<span class="string">&quot;application&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>隐式传参<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：path、group、version、dubbo、token、timeout几个key是保留字段，请使用其它值</span></span><br><span class="line"><span class="comment">// 消费者端隐式传参，后面的远程调用都会隐式将这些参数发送到服务端，用于框架集成，不建议常规业务使用</span></span><br><span class="line">RpcContext.getContext().setAttachment(<span class="string">&quot;index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">xxxService.xxx(); <span class="comment">// 远程调用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提供者端，获取客户端隐式传入的参数，用于框架集成，不建议常规业务使用</span></span><br><span class="line">RpcContext.getContext().getAttachment(<span class="string">&quot;index&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>异步调用（基于NIO的非阻塞实现并行调用，客户端不需要启动多线程即可完成并行调用多个远程服务）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	async：开启异步执行，默认false</span></span><br><span class="line"><span class="comment">	sent：true（等待消息发出，消息发送失败将抛出异常）/false（不等待消息发出，将消息放入IO队列）</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;...&quot;</span> <span class="attr">async</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sent</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此调用会立即返回null</span></span><br><span class="line">fooService.findFoo(fooId);</span><br><span class="line"><span class="comment">// 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future</span></span><br><span class="line">Future&lt;Foo&gt; fooFuture = RpcContext.getContext().getFuture(); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 此调用会立即返回null</span></span><br><span class="line">barService.findBar(barId);</span><br><span class="line"><span class="comment">// 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future</span></span><br><span class="line">Future&lt;Bar&gt; barFuture = RpcContext.getContext().getFuture(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//此时findFoo和findBar的请求同时在执行，客户端不需要启动多线程来支持并行，而是借助NIO的非阻塞完成</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果foo已返回，直接拿到返回值，否则线程wait住，等待foo返回后，线程会被notify唤醒</span></span><br><span class="line"><span class="type">Foo</span> <span class="variable">foo</span> <span class="operator">=</span> fooFuture.get(); </span><br><span class="line"><span class="comment">// 同理等待bar返回</span></span><br><span class="line"><span class="type">Bar</span> <span class="variable">bar</span> <span class="operator">=</span> barFuture.get(); </span><br><span class="line"><span class="comment">// 如果foo需要5秒返回，bar需要6秒返回，实际只需等6秒，即可获取到foo和bar，进行接下来的处理。</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h4><p>入口类ServiceBean<br><img data-src="/images/dubbo-provider.jpg" alt="时序图"></p>
<h4 id="服务消费"><a href="#服务消费" class="headerlink" title="服务消费"></a>服务消费</h4><p>入口类ReferenceBean<br><img data-src="/images/dubbo-consumer.jpg" alt="时序图"></p>
<h4 id="Exporter"><a href="#Exporter" class="headerlink" title="Exporter"></a>Exporter</h4><p>暴露服务或取消服务</p>
<h4 id="Invoker"><a href="#Invoker" class="headerlink" title="Invoker"></a>Invoker</h4><p>Javassist动态代理生成的代理对象，执行具体的远程调用</p>
<h4 id="Directory"><a href="#Directory" class="headerlink" title="Directory"></a>Directory</h4><p>对多个invoker进行组装</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="快递小哥 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="快递小哥 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>快递小哥
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://yoursite.com/2018/08/20/dubbo/" title="Dubbo">http://yoursite.com/2018/08/20/dubbo/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Dubbo/" rel="tag"><i class="fa fa-tag"></i> Dubbo</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/08/16/juc/" rel="prev" title="juc并发包">
                  <i class="fa fa-angle-left"></i> juc并发包
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/08/23/jvm/" rel="next" title="jvm">
                  jvm <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">快递小哥</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xlZTkyMTM=" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"http://yoursite.com/2018/08/20/dubbo/"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"lee9213","repo":"blog-common-log","client_id":"Ov23liRhRq195JbLB8GO","client_secret":"d8f3efcc7511d7aad6941e8cda1d1d764c1a6d56","admin_user":"lee9213","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"5f3c604f722e656eaea9af0b75796fd3"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
